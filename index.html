<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/main.css">
    <!-- Tema escuro permanente -->
    <link id="dark-theme-css" rel="stylesheet" href="css/dark.css">
</head>
<body>
    <!-- Tela de Loading -->
    <div id="loading-screen" class="screen active">
        <div class="loading-container">
            <div class="logo-loading">
                <div class="logo-icon">ğŸ›ï¸</div>
                <h1 class="logo-text">Labirinto de Creta</h1>
            </div>
            <div class="loading-bar-container">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-text" id="loading-text">Inicializando...</div>
            <div class="loading-info">
                <p>ğŸ® Preparando o desafio do Minotauro...</p>
            </div>
        </div>
    </div>

    <!-- Tela de Menu -->
    <div id="menu-screen" class="screen">
        <div class="menu-container">
            <div class="menu-header">
                <div class="logo">
                    <div class="logo-icon">ğŸ›ï¸</div>
                    <h1 class="logo-title">Labirinto de Creta</h1>
                    <p class="logo-subtitle">O Desafio do Minotauro</p>
                </div>
                <!-- Perfil do jogador (preenchido por js/usuario-ui.js) -->
                <div id="user-profile" class="user-profile">
                    <div class="user-avatar" id="user-avatar">âš”ï¸</div>
                    <div class="user-info">
                        <div class="user-name" id="user-name">Jogador</div>
                        <button id="btn-edit-profile" class="menu-btn tertiary small">âœï¸ Editar</button>
                    </div>
                </div>
            </div>
            <div class="menu-buttons">
                <button id="btn-start-game" class="menu-btn primary">
                    <span>âš”ï¸</span>
                    <span>Iniciar Jogo</span>
                </button>
                <button id="btn-levels" class="menu-btn tertiary">
                    <span>ğŸ“œ</span>
                    <span>Escolher NÃ­vel</span>
                </button>
                <button id="btn-help" class="menu-btn secondary">
                    <span>â“</span>
                    <span>Como Jogar</span>
                </button>
                <button id="btn-settings" class="menu-btn tertiary">
                    <span>âš™ï¸</span>
                    <span>ConfiguraÃ§Ãµes</span>
                </button>
            </div>
            <div class="menu-footer">
                <p class="controls-hint">ğŸ® WASD para mover â€¢ SPACE para Fio â€¢ SHIFT para correr</p>
                <p class="version-info">v2.1.0 â€¢ HTML5 Game</p>
            </div>
        </div>
    </div>

    <!-- Tela de Jogo -->
    <div id="game-screen" class="screen">
        <div class="game-hud">
            <div class="hud-left">
                <div class="hud-item">
                    <span class="hud-label">NÃ­vel:</span>
                    <span class="hud-value" id="hud-level">1</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label">Tempo:</span>
                    <span class="hud-value" id="hud-time">00:00.000</span>
                </div>
            </div>
            <div class="hud-center">
                <h1 class="game-title">ğŸ›ï¸ Labirinto de Creta</h1>
            </div>
            <div class="hud-right">
                <div class="hud-item">
                    <span class="hud-label">Fio:</span>
                    <span class="hud-value" id="hud-thread">INATIVO</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label">Minotauro:</span>
                    <span class="hud-value" id="hud-minotaur">PATRULHA</span>
                </div>
                <div class="hud-item">
                    <span class="hud-label">Corrida:</span>
                    <span class="hud-value" id="hud-running">ğŸš¶</span>
                </div>
                <!-- ğŸ”Š Controle de Volume no HUD -->
                <div class="hud-item hud-volume">
                    <button id="btn-volume" class="volume-button" title="Volume do Caos">ğŸ”Š</button>
                    <div id="volume-popover" class="volume-popover">
                        <div class="volume-label">Volume do Caos</div>
                        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="50">
                        <div class="volume-emoji" id="volumeEmoji">ğŸ”Š</div>
                        <div class="volume-joke" id="volumeJoke">Mudo? Como vai ouvir o Minotauro chegando?</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="game-area">
            <canvas id="game-canvas" width="600" height="450"></canvas>
        </div>
    </div>

    <!-- Overlay de Game Over -->
    <div id="gameover-overlay" class="overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ’€ Capturado!</h2>
            </div>
            <div class="modal-content">
                <p>O Minotauro te capturou! Tente novamente.</p>
            </div>
            <div class="modal-actions">
                <button id="btn-retry" class="modal-btn primary">ğŸ”„ Tentar Novamente</button>
                <button id="btn-menu-from-gameover" class="modal-btn secondary">ğŸ  Menu</button>
            </div>
        </div>
    </div>

    <!-- Overlay de VitÃ³ria -->
    <div id="victory-overlay" class="overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ‰ NÃ­vel ConcluÃ­do!</h2>
            </div>
            <div class="modal-content">
                <p>ParabÃ©ns! VocÃª escapou do labirinto!</p>
                <div class="victory-stats">
                    <div class="stat-item">
                        <span class="stat-label">Tempo:</span>
                        <span class="stat-value" id="victory-time">0s</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">NÃ­vel:</span>
                        <span class="stat-value" id="victory-level">1</span>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="btn-next-level" class="modal-btn primary">â¡ï¸ PrÃ³ximo NÃ­vel</button>
                <button id="btn-menu-from-victory" class="modal-btn secondary">ğŸ  Menu</button>
            </div>
        </div>
    </div>

    <!-- Overlay de TransiÃ§Ã£o de NÃ­vel -->
    <div id="level-transition" class="level-transition">
        <div class="transition-text" id="transition-text">
            ğŸ›ï¸ Entrando no PrÃ³ximo NÃ­vel...
        </div>
    </div>

    <!-- Overlay de ConfiguraÃ§Ãµes -->
    <div id="settings-overlay" class="overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">âš™ï¸ ConfiguraÃ§Ãµes</h2>
            </div>
            <div class="modal-content">
                <div class="settings-grid">
                    <div class="settings-group">
                        <h3>ğŸ”Š Ãudio</h3>
                        <label class="setting-row">
                            <input type="checkbox" id="settings-music" checked>
                            <span>MÃºsica habilitada</span>
                        </label>
                        <label class="setting-row">
                            <input type="checkbox" id="settings-sfx" checked>
                            <span>Efeitos sonoros habilitados</span>
                        </label>
                        <label class="setting-row column">
                            <span>Volume geral</span>
                            <input type="range" id="settings-volume" min="0" max="100" value="50">
                        </label>
                    </div>
                    <div class="settings-group">
                        <h3>ğŸ‘¤ Conta</h3>
                        <label class="setting-row">
                            <span>Nome do jogador</span>
                            <input type="text" id="settings-username" placeholder="Seu nome">
                        </label>
                        <label class="setting-row">
                            <span>Avatar</span>
                            <input type="text" id="settings-avatar" placeholder="Emoji ou texto curto">
                        </label>
                        <div class="setting-row">
                            <button id="btn-export-user" class="modal-btn tertiary">Exportar Perfil</button>
                            <button id="btn-import-user" class="modal-btn secondary">Importar Perfil</button>
                            <input type="file" id="input-import-file" accept="application/json" style="display:none">
                        </div>
                    </div>
                    <div class="settings-group">
                        <h3>ğŸ® Jogabilidade</h3>
                        <label class="setting-row">
                            <input type="checkbox" id="settings-thread">
                            <span>Fio de Ariadne ativo ao iniciar</span>
                        </label>
                        <label class="setting-row">
                            <span>Dificuldade do Minotauro</span>
                            <select id="settings-difficulty">
                                <option value="easy">FÃ¡cil</option>
                                <option value="normal" selected>Normal</option>
                                <option value="hard">DifÃ­cil</option>
                            </select>
                        </label>
                        <label class="setting-row">
                            <input type="checkbox" id="settings-showpath">
                            <span>Mostrar caminho do Minotauro (debug)</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="btn-settings-close" class="modal-btn tertiary">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Overlay: Como Jogar -->
    <div id="help-overlay" class="overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">â“ Como Jogar</h2>
            </div>
            <div class="modal-content">
                <div class="help-section">
                    <h3>ğŸ¯ Objetivo</h3>
                    <p>Guie Teseu (âš”ï¸) pelos corredores brancos atÃ© a saÃ­da (quadrado ğŸŸ©) sem ser capturado pelo Minotauro (ğŸ‚).</p>
                </div>
                <div class="help-section">
                    <h3>ğŸ® Controles</h3>
                    <ul class="help-list">
                        <li><span class="kbd">W</span><span class="kbd">A</span><span class="kbd">S</span><span class="kbd">D</span> ou setas â€” mover</li>
                        <li><span class="kbd">Shift</span> â€” correr (2Ã— mais rÃ¡pido)</li>
                        <li><span class="kbd">Space</span> â€” Fio de Ariadne (rastro dourado)</li>
                        <li><span class="kbd">Esc</span> â€” voltar ao menu</li>
                    </ul>
                </div>
                <div class="help-section">
                    <h3>ğŸ§  Minotauro</h3>
                    <p>Patrulha o labirinto e usa um caminho inteligente (A*) para te alcanÃ§ar quando te detecta. Fique atento ao som e ao brilho vermelho quando ele entra em perseguiÃ§Ã£o.</p>
                </div>
                <div class="help-section">
                    <h3>ğŸ—ºï¸ Legenda</h3>
                    <ul class="help-list legend">
                        <li>âš”ï¸ Teseu (vocÃª)</li>
                        <li>ğŸ‚ Minotauro</li>
                        <li>ğŸŸ© SaÃ­da</li>
                        <li>ğŸŸ¨ Fio de Ariadne (rastro)</li>
                    </ul>
                </div>
            </div>
            <div class="modal-actions">
                <button id="btn-help-close" class="modal-btn tertiary">Fechar</button>
            </div>
        </div>
    </div>

    <script type="module" src="js/app.js"></script>

    <script type="module">
    // IntegraÃ§Ã£o leve do Temporizador (arquivo: js/temporizador.js)
    import Temporizador from './js/temporizador.js';

    // Instancia o temporizador e atualiza automaticamente o elemento #hud-time
    const timer = new Temporizador({ selector: '#hud-time', precision: 50 });
    // Expor globalmente para depuraÃ§Ã£o/integraÃ§Ã£o posterior
    window.__GameTimer = timer;

    // FunÃ§Ãµes utilitÃ¡rias
    const format = ms => Temporizador.format(ms);

    // BotÃµes conhecidos para controlar o temporizador
    const btnStart = document.getElementById('btn-start-game');
    const btnRetry = document.getElementById('btn-retry');
    const btnMenuFromGameover = document.getElementById('btn-menu-from-gameover');
    const btnMenuFromVictory = document.getElementById('btn-menu-from-victory');
    const btnNextLevel = document.getElementById('btn-next-level');

    btnStart?.addEventListener('click', () => {
        // Reinicia e inicia quando o usuÃ¡rio pressiona Iniciar
        timer.reset();
        timer.start();
    });

    // Ao tentar novamente, resetamos o temporizador
    btnRetry?.addEventListener('click', () => timer.reset());

    // Voltar ao menu: reset
    btnMenuFromGameover?.addEventListener('click', () => timer.reset());
    btnMenuFromVictory?.addEventListener('click', () => timer.reset());

    // PrÃ³ximo nÃ­vel: parar e reiniciar para o prÃ³ximo nÃ­vel
    btnNextLevel?.addEventListener('click', () => { timer.reset(); timer.start(); });

    // Observadores para overlays: pausam/registram tempo quando aparecem
    const gameoverOverlay = document.getElementById('gameover-overlay');
    const victoryOverlay = document.getElementById('victory-overlay');

    const observeOverlay = (el, onShow) => {
        if (!el) return;
        const mo = new MutationObserver(() => {
            // Quando a classe 'active' Ã© adicionada, considera-se mostrado
            if (el.classList.contains('active')) onShow();
            // TambÃ©m considera style.display changes
            const ds = window.getComputedStyle(el).display;
            if (ds !== 'none' && ds !== '') onShow();
        });
        mo.observe(el, { attributes: true, attributeFilter: ['class', 'style'] });
    };

    observeOverlay(gameoverOverlay, () => {
        // Pausa o temporizador quando o jogador Ã© capturado
        timer.pause();
    });

    observeOverlay(victoryOverlay, () => {
        // Pausa e registra o tempo final na tela de vitÃ³ria
        timer.pause();
        const vt = document.getElementById('victory-time');
        if (vt) vt.textContent = format(timer.getTime());
    });

    </script>
    <script type="module" src="js/usuario-ui.js"></script>
    <!-- Level selector overlay -->
    <div id="level-select-overlay" class="overlay">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“œ Selecionar NÃ­vel</h2>
            </div>
            <div class="modal-content">
                <!-- grid serÃ¡ inserida por js/level-selector.js -->
            </div>
            <div class="modal-actions">
                <button id="btn-close-levels" class="modal-btn tertiary">Fechar</button>
            </div>
        </div>
    </div>
    <script type="module" src="js/level-selector.js"></script>
    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="overlay">
        <div class="modal" role="dialog" aria-modal="true" aria-labelledby="edit-profile-title">
            <div class="modal-header">
                <h2 id="edit-profile-title" class="modal-title">âœï¸ Editar Perfil</h2>
            </div>
            <div class="modal-content">
                <label class="setting-row column">
                    <span>Nome do jogador</span>
                    <input type="text" id="edit-profile-name" placeholder="Seu nome">
                </label>
                <label class="setting-row column">
                    <span>Avatar</span>
                    <input type="text" id="edit-profile-avatar" placeholder="Emoji ou texto curto">
                </label>
            </div>
            <div class="modal-actions">
                <button id="edit-profile-save" class="modal-btn primary">Salvar</button>
                <button id="edit-profile-cancel" class="modal-btn tertiary">Cancelar</button>
            </div>
        </div>
    </div>
</body>
</html>